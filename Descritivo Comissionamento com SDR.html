<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demonstrativo de Comissão Editável</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .editable {
            background-color: #f0f9ff; /* Um azul bem claro */
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px dashed #93c5fd; /* Borda azul pontilhada */
            cursor: text;
            min-width: 50px;
            display: inline-block;
            text-align: center;
        }
        .editable-wide {
             min-width: 80px;
             text-align: left;
        }
        .editable:focus {
            background-color: #e0f2fe;
            outline: 2px solid #3b82f6;
        }
        /* Estilo para o texto de ajuda (placeholder) */
        [contenteditable]:empty::before {
            content: attr(data-placeholder);
            color: #a1a1aa; /* Cor cinza para o placeholder */
            pointer-events: none;
            display: inline-block;
        }
        .calculated {
            min-width: 80px;
            display: inline-block;
            font-weight: 600;
            color: #1e40af; /* Azul escuro */
            background-color: #eef2ff;
            padding: 2px 6px;
            border-radius: 4px;
        }
        /* Estilos específicos para impressão */
        @media print {
            @page {
                size: A4;
                margin: 0.75in;
            }
            body {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                font-size: 9pt; /* Reduz ainda mais a fonte */
            }
            .no-print {
                display: none;
            }
            .editable, .calculated {
                border: none;
                padding: 1px 0;
                background-color: transparent !important;
            }
            [contenteditable]:empty::before {
                content: ""; /* Esconde o placeholder na impressão */
            }
            /* Regra para forçar a impressão de cores de fundo e texto */
            .bg-blue-50, .bg-indigo-50, .bg-gray-50, .bg-gray-800, .bg-teal-50, .text-blue-700, .text-blue-800, .text-indigo-800, .text-indigo-900, .text-green-800, .text-white, .text-teal-700, .text-teal-800 {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            /* Garante que o texto no box final permaneça branco */
            #valor-liquido {
                color: white !important;
            }
            .print-container {
                padding: 0 !important;
                box-shadow: none !important;
                border: none !important;
            }
            .print-header {
                padding-bottom: 0.5rem !important;
                margin-bottom: 0.5rem !important;
            }
            .print-header h1 { font-size: 16pt; }
            .print-header h2 { font-size: 14pt; margin-bottom: 0.75rem; }
            .print-section-spacing {
                space-y-0 !important;
            }
            .print-section {
                padding: 0.5rem !important;
                margin-top: 0.5rem !important;
            }
            .print-section-title {
                margin-bottom: 0.5rem !important;
                padding-bottom: 0.25rem !important;
                font-size: 10pt;
            }
            .print-dist-row {
                padding: 0.25rem !important;
            }
            .print-final-box {
                padding: 0.75rem !important;
                margin-top: 1rem !important;
            }
            .print-final-box h3 {
                font-size: 11pt;
            }
             .print-final-box p {
                font-size: 13pt;
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">
    <!-- A largura máxima foi ajustada de max-w-4xl para max-w-3xl para compactar o layout -->
    <div class="w-full max-w-3xl bg-white rounded-lg shadow-lg p-8 sm:p-10 lg:p-12 print-container">

        <!-- Cabeçalho da Imobiliária -->
        <header class="text-center border-b pb-6 mb-8 print-header">
            <h1 class="text-3xl font-bold text-gray-800" contenteditable="false">Jarvis Inteligência Imobiliária</h1>
            <p class="text-sm text-gray-500 mt-2 leading-relaxed">
                Rua Soldado Eduardo dos Santos, 55, Ponta Verde, Maceió - Alagoas<br>
                CNPJ: 49.086.785/0001-56
            </p>
        </header>

        <!-- Título do Demonstrativo e Dados do Corretor -->
        <div class="mb-8 print-header">
            <h2 class="text-2xl font-semibold text-center text-gray-700 mb-6">DEMONSTRATIVO DE COMISSÃO</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div class="bg-gray-50 p-3 rounded-md">
                    <p class="font-semibold text-gray-600">Corretor(a):</p>
                    <p class="text-gray-800" contenteditable="true" id="nome-corretor" data-placeholder="Nome do corretor"></p>
                </div>
                <div class="bg-gray-50 p-3 rounded-md">
                    <p class="font-semibold text-gray-600">CPF/CNPJ:</p>
                    <p class="text-gray-800" contenteditable="true" id="cpf-cnpj" data-placeholder="000.000.000-00"></p>
                </div>
                <div class="bg-gray-50 p-3 rounded-md">
                    <p class="font-semibold text-gray-600">Data do Pagamento:</p>
                    <p class="text-gray-800" contenteditable="true" id="data-pagamento" data-placeholder="dd/mm/aaaa"></p>
                </div>
            </div>
        </div>

        <!-- Seções de Cálculo -->
        <div class="space-y-6 print-section-spacing">
            <!-- 1. Detalhes da Transação -->
            <div class="border border-gray-200 rounded-lg p-5 print-section">
                <h3 class="font-semibold text-lg text-gray-800 mb-4 border-b pb-2 print-section-title">1. Detalhes da Transação</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <p><strong class="text-gray-600">Imóvel:</strong> <span contenteditable="true" class="editable editable-wide" data-placeholder="Nome do Condomínio"></span></p>
                    <p><strong class="text-gray-600">Código do Imóvel:</strong> <span contenteditable="true" class="editable editable-wide" data-placeholder="Código no Sistema"></span></p>
                    <p><strong class="text-gray-600">Tipo:</strong> <span contenteditable="true" class="editable editable-wide" data-placeholder="Venda ou Locação"></span></p>
                    <p><strong class="text-gray-600">Complemento:</strong> <span contenteditable="true" class="editable editable-wide" data-placeholder="Ex: Apto 101"></span></p>
                    <p><strong class="text-gray-600">SDR:</strong> <span contenteditable="true" class="editable editable-wide" data-placeholder="Nome do SDR"></span></p>
                    <p><strong class="text-gray-600">Gerente:</strong> <span contenteditable="true" class="editable editable-wide" data-placeholder="Nome do Gerente"></span></p>
                </div>
            </div>

            <!-- 2. Cálculo da Comissão Bruta -->
            <div class="border border-gray-200 rounded-lg p-5 print-section">
                <h3 class="font-semibold text-lg text-gray-800 mb-4 border-b pb-2 print-section-title">2. Cálculo da Comissão Bruta</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <p class="text-gray-600">Valor Total da Venda:</p>
                        <p class="font-medium text-gray-800">R$ <span contenteditable="true" class="editable editable-wide" id="valor-venda" oninput="handleCurrencyInput(event)" data-placeholder="0,00"></span></p>
                    </div>
                    <div>
                        <p class="text-gray-600">% Comissão Total (Calculado):</p>
                        <p class="font-medium text-gray-800"><span id="percentual-comissao" class="calculated">...</span>%</p>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-md">
                        <p class="text-blue-700">Comissão Bruta Total:</p>
                        <p class="font-bold text-blue-800 text-base">R$ <span contenteditable="true" class="editable editable-wide" id="comissao-bruta" oninput="handleCurrencyInput(event)" data-placeholder="0,00"></span></p>
                    </div>
                    <div>
                        <p class="text-gray-600">% de Imposto:</p>
                        <p class="font-medium text-gray-800"><span contenteditable="true" class="editable" id="perc-imposto" oninput="handleCurrencyInput(event)" data-placeholder="0,00"></span>%</p>
                    </div>
                    <div class="bg-teal-50 p-3 rounded-md md:col-span-2">
                        <p class="text-teal-700">Comissão Total Líquida:</p>
                        <p class="font-bold text-teal-800 text-base">R$ <span id="comissao-liquida" class="calculated">...</span></p>
                    </div>
                </div>
            </div>

            <!-- 3. Distribuição da Comissão -->
            <div class="border border-gray-200 rounded-lg p-5 print-section">
                <h3 class="font-semibold text-lg text-gray-800 mb-4 border-b pb-2 print-section-title">3. Distribuição da Comissão</h3>
                <div class="space-y-3">
                    <!-- Comercial -->
                    <div class="flex justify-between items-center bg-indigo-50 p-3 rounded-md mb-4 print-dist-row">
                        <span class="font-semibold text-lg text-indigo-800">Comercial (47%):</span>
                        <span class="font-bold text-xl text-indigo-900">R$ <span id="valor-comercial" class="calculated">...</span></span>
                    </div>
                    <!-- Corretor -->
                    <div class="flex justify-between items-center bg-gray-50 p-2 rounded-md print-dist-row">
                        <span class="font-medium text-gray-700">% do Corretor:</span>
                        <span class="font-semibold text-gray-800 px-2">57,45%</span>
                        <span class="font-medium text-gray-700">Valor do Corretor:</span>
                        <span class="font-bold text-green-800 text-base">R$ <span id="valor-corretor" class="calculated">...</span></span>
                    </div>
                    <!-- Captador -->
                    <div class="flex justify-between items-center bg-gray-50 p-2 rounded-md print-dist-row">
                        <span class="font-medium text-gray-700">% do Captador:</span>
                        <span class="font-semibold text-gray-800 px-2">29,80%</span>
                        <span class="font-medium text-gray-700">Valor do Captador:</span>
                        <span class="font-bold text-green-800 text-base">R$ <span id="valor-captador" class="calculated">...</span></span>
                    </div>
                    <!-- SDR -->
                    <div class="flex justify-between items-center bg-gray-50 p-2 rounded-md print-dist-row">
                        <span class="font-medium text-gray-700">% do SDR:</span>
                        <span class="font-semibold text-gray-800 px-2">12,76%</span>
                        <span class="font-medium text-gray-700">Valor do SDR:</span>
                        <span class="font-bold text-green-800 text-base">R$ <span id="valor-sdr" class="calculated">...</span></span>
                    </div>
                </div>
            </div>

        <!-- Botões de Ação -->
        <div class="text-center mt-8 no-print space-x-4">
            <button onclick="window.print()" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors">
                Imprimir / Salvar PDF
            </button>
            <button onclick="limparCampos()" class="bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-700 transition-colors">
                Limpar Campos
            </button>
        </div>
    </div>

    <script>
        // Função para converter texto formatado (ex: "1.234,56") em número
        function parseCurrency(value) {
            if (typeof value !== 'string') return 0;
            // Remove tudo que não for dígito ou vírgula, e troca a vírgula por ponto
            let numberString = value.replace(/[^\d,]/g, '').replace(',', '.');
            return parseFloat(numberString) || 0;
        }

        // Função para formatar um número como moeda brasileira (ex: 1.234,56)
        function formatCurrency(value) {
            if (isNaN(value)) return '0,00';
            return value.toFixed(2).replace('.', ',').replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
        }

        // Função para formatar o campo de moeda enquanto o usuário digita
        function handleCurrencyInput(event) {
            const element = event.target;
            let value = element.innerText.replace(/\D/g, ''); // Pega apenas os dígitos

            if (value === '') {
                element.innerText = '';
            } else {
                const number = parseInt(value, 10) / 100;
                element.innerText = number.toLocaleString('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            }

            // Move o cursor para o final do conteúdo
            const range = document.createRange();
            const selection = window.getSelection();
            range.selectNodeContents(element);
            range.collapse(false); // 'false' colapsa para o final
            selection.removeAllRanges();
            selection.addRange(range);

            // Executa os cálculos após a formatação
            realizarCalculos();
        }

        // Função principal para realizar os cálculos
        function realizarCalculos() {
            // Cálculo do Percentual da Comissão Total
            const valorVendaEl = document.getElementById('valor-venda');
            const comissaoBrutaEl = document.getElementById('comissao-bruta');
            const percentualEl = document.getElementById('percentual-comissao');

            const valorVenda = parseCurrency(valorVendaEl.innerText);
            const comissaoBruta = parseCurrency(comissaoBrutaEl.innerText);

            if (valorVenda > 0 && comissaoBruta > 0) {
                const percentual = (comissaoBruta / valorVenda) * 100;
                percentualEl.innerText = percentual.toFixed(2).replace('.', ',');
            } else {
                percentualEl.innerText = '...';
            }

            // Cálculo da Comissão Líquida
            const percImpostoEl = document.getElementById('perc-imposto');
            const percImposto = parseCurrency(percImpostoEl.innerText) / 100;
            const comissaoLiquida = comissaoBruta * (1 - percImposto);
            document.getElementById('comissao-liquida').innerText = formatCurrency(comissaoLiquida);

            // Cálculo do valor do Comercial
            const valorComercialEl = document.getElementById('valor-comercial');
            const valorComercial = comissaoLiquida * 0.47;
            valorComercialEl.innerText = formatCurrency(valorComercial);

            // Cálculo da Distribuição da Comissão com base no valor do Comercial
            const percCorretor = 0.5745; // 57,45%
            const percCaptador = 0.2980; // 29,80%
            const percSDR = 0.1276;    // 12,76%

            const valorCorretor = valorComercial * percCorretor;
            const valorCaptador = valorComercial * percCaptador;
            const valorSDR = valorComercial * percSDR;

            document.getElementById('valor-corretor').innerText = formatCurrency(valorCorretor);
            document.getElementById('valor-captador').innerText = formatCurrency(valorCaptador);
            document.getElementById('valor-sdr').innerText = formatCurrency(valorSDR);
            
            // Atualiza o Valor Líquido a Receber para ser igual ao Valor do Corretor
            document.getElementById('valor-liquido').innerText = formatCurrency(valorCorretor);
        }

        function limparCampos() {
            if (confirm("Tem certeza que deseja limpar todos os campos preenchidos?")) {
                const camposEditaveis = document.querySelectorAll('[contenteditable="true"]');
                camposEditaveis.forEach(campo => {
                    // Apaga o conteúdo do campo
                    campo.innerHTML = '';
                });
                // Limpa também os campos calculados
                document.getElementById('percentual-comissao').innerText = '...';
                document.getElementById('comissao-liquida').innerText = '...';
                document.getElementById('valor-comercial').innerText = '...';
                document.getElementById('valor-corretor').innerText = '...';
                document.getElementById('valor-captador').innerText = '...';
                document.getElementById('valor-sdr').innerText = '...';
                document.getElementById('valor-liquido').innerText = '...';
            }
        }
    </script>
</body>
</html>
